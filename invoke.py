#!/usr/bin/python
import json
from web3 import Web3,RPCProvider

w3 = Web3(RPCProvider(host="localhost",port="8545"))


abi = '''[{"constant":false,"inputs":[{"name":"c","type":"string"}],"name":"SendTweet","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function"},{"anonymous":false,"inputs":[{"indexed":false,"name":"cool_string","type":"string"}],"name":"FireTweetEvent","type":"event"}]'''
code_runtime = '60606040526000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063b528f9f21461003b575bfe5b341561004357fe5b610093600480803590602001908201803590602001908080601f016020809104026020016040519081016040528093929190818152602001838380828437820191505050505050919050506100ad565b604051808215151515815260200191505060405180910390f35b6000608c825111151561016d577f29781825c4580a032aa231d9d691d862ea1e9692413f1f1cd2bb3e09c9f3beb282604051808060200182810382528381815181526020019150805190602001908083836000831461012b575b80518252602083111561012b57602082019150602081019050602083039250610107565b505050905090810190601f1680156101575780820380516001836020036101000a031916815260200191505b509250505060405180910390a160019050610172565b600090505b9190505600a165627a7a72305820ace996d70fcc769d3c46aa73a3a9d93bbc5e78d7b35473873063350ad9f8d9c10029'
code = '6060604052341561000c57fe5b5b6101a38061001c6000396000f30060606040526000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063b528f9f21461003b575bfe5b341561004357fe5b610093600480803590602001908201803590602001908080601f016020809104026020016040519081016040528093929190818152602001838380828437820191505050505050919050506100ad565b604051808215151515815260200191505060405180910390f35b6000608c825111151561016d577f29781825c4580a032aa231d9d691d862ea1e9692413f1f1cd2bb3e09c9f3beb282604051808060200182810382528381815181526020019150805190602001908083836000831461012b575b80518252602083111561012b57602082019150602081019050602083039250610107565b505050905090810190601f1680156101575780820380516001836020036101000a031916815260200191505b509250505060405180910390a160019050610172565b600090505b9190505600a165627a7a72305820ace996d70fcc769d3c46aa73a3a9d93bbc5e78d7b35473873063350ad9f8d9c10029'
source = '''pragma solidity ^0.4.0;
contract TweetyBird {
    event FireTweetEvent(string cool_string);
    function SendTweet(string c) returns (bool){
        if(bytes(c).length <= 140){
            FireTweetEvent(c);
            return true;
        }
        return false;
    }
}'''

contract_factory = w3.eth.contract(abi=json.loads(abi),code=code,code_runtime=code_runtime,source=source)
contract = contract_factory(json.loads(abi),address='0xa162441bc58e4a87d3f3b206e5feb0b8ce3e8edd')

contract.transact().SendTweet("hello")
